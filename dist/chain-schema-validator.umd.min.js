!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).chainSchemaValidator=e()}(this,function(){"use strict";function t(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}
/**
	 * @license
	 * MIT License
	 *
	 * Copyright (c) 2025 MAMEDUL ISLAM
	 */class e extends Error{constructor(t){super(t.map(t=>t.message).join(". ")),this.name="ValidationError",this.details=t,this.statusCode=400}}const s=(t,e)=>t&&t.isRef?e[t.key]:t,r=t=>null!=t,i=t=>{let e=(t+"").split("").reverse().map(t=>parseInt(t)),s=e.splice(0,1)[0];return(e.reduce((t,e,s)=>s%2!=0?t+e:t+((e*=2)>9?e-9:e),0)+s)%10==0};class a{constructor(t){this._type=t,this._rules=[],this._transformers=[],this._flags={optional:!0,nullable:!1,strip:!1},this._meta={},this._hasAsync=!1}required(){return this._flags.optional=!1,this}optional(){return this._flags.optional=!0,this}nullable(){return this._flags.nullable=!0,this}forbidden(){return this.addRule("forbidden",t=>!r(t),"is forbidden"),this}strip(){return this._flags.strip=!0,this}default(t){return this.addTransformer(e=>null==e?t:e),this}valid(...t){return this.addRule("valid",e=>t.includes(e),`must be one of [${t.join(", ")}]`),this}invalid(...t){return this.addRule("invalid",e=>!t.includes(e),`must not be one of [${t.join(", ")}]`),this}oneOf(t){return this.valid(...t)}notOneOf(t){return this.invalid(...t)}transform(t){return this.addTransformer(t),this}custom(t,e){return this.addRule("custom",t,e||"failed custom validation"),this}customAsync(t,e){return this._hasAsync=!0,this.addRule("customAsync",t,e||"failed async validation"),this}concat(t){return this._rules.push(...t._rules),this._transformers.push(...t._transformers),this}meta(t){return this._meta={...this._meta,...t},this}message(t){return this._rules.length>0&&(this._rules[this._rules.length-1].customMessage=t),this}pattern(t,e){return this.addRule("pattern",e=>t.test(e),e||"fails to match pattern"),this}min(t){return this.addRule("min",(e,r)=>e.length>=s(t,r),`length must be at least ${t.isRef?`{${t.key}}`:t}`),this}max(t){return this.addRule("max",(e,r)=>e.length<=s(t,r),`length must be at most ${t.isRef?`{${t.key}}`:t}`),this}length(t){return this.addRule("length",(e,r)=>e.length===s(t,r),`length must be exactly ${t.isRef?`{${t.key}}`:t}`),this}creditCard(){return this.addRule("creditCard",i,"must be a valid credit card number"),this}ip(){return this.addRule("ip",t=>/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(t),"must be a valid IP address"),this}uuid(){return this.addRule("uuid",t=>/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-5][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$/.test(t),"must be a valid UUID"),this}hex(){return this.addRule("hex",t=>/^[a-fA-F0-9]+$/.test(t),"must be a hexadecimal string"),this}token(){return this.addRule("token",t=>/^[a-zA-Z0-9_]+$/.test(t),"must be a valid token"),this}isoDate(){return this.addRule("isoDate",t=>!isNaN(new Date(t).getTime()),"must be a valid ISO date"),this}trim(){return this.addTransformer(t=>"string"==typeof t?t.trim():t),this}lowercase(){return this.addTransformer(t=>"string"==typeof t?t.toLowerCase():t),this}uppercase(){return this.addTransformer(t=>"string"==typeof t?t.toUpperCase():t),this}greater(t){return this.addRule("greater",(e,r)=>e>s(t,r),`must be greater than ${t.isRef?`{${t.key}}`:t}`),this}less(t){return this.addRule("less",(e,r)=>e<s(t,r),`must be less than ${t.isRef?`{${t.key}}`:t}`),this}integer(){return this.addRule("integer",Number.isInteger,"must be an integer"),this}positive(){return this.addRule("positive",t=>t>0,"must be positive"),this}negative(){return this.addRule("negative",t=>t<0,"must be negative"),this}port(){return this.addRule("port",t=>Number.isInteger(t)&&t>=0&&t<=65535,"must be a valid port"),this}items(t){return this.addRule("items",()=>!0,"",{schema:t}),this}unique(){return this.addRule("unique",t=>new Set(t).size===t.length,"must contain unique values"),this}has(t){return this.addRule("has",()=>!0,"must contain at least one required item",{schema:t}),this}single(){return this.addTransformer(t=>Array.isArray(t)?t:[t]),this}keys(t){return this._schemaObject=t,this}addRule(t,e,s,r){this._rules.push({type:t,validate:e,message:s,options:r})}addTransformer(t){this._transformers.push(t)}async _validate(t,e){if(this._flags.strip)return{value:void 0,error:null};if(!r(t))return this._flags.optional?{value:t,error:null}:{error:"is required"};if(this._flags.nullable&&null===t)return{value:null,error:null};let s=t;for(const t of this._transformers)s=t(s);for(const t of this._rules){let r;if(r="customAsync"===t.type?await t.validate(s,e):t.validate(s,e),!r)return{error:t.customMessage||t.message}}if("array"===this._type&&this._rules.some(t=>"items"===t.type)){const t=this._rules.find(t=>"items"===t.type).options.schema,r=[];for(let i=0;i<s.length;i++){const{value:a,error:n}=await t._validate(s[i],e);if(n)return{error:`[at index ${i}] ${n}`};t._flags.strip||r.push(a)}s=r}if("object"===this._type&&this._schemaObject){const{value:t,error:e}=await u.object(this._schemaObject)._validateObject(s);if(e)return{error:e.details.map(t=>`${t.field}: ${t.message}`).join(", ")};s=t}return{value:s,error:null}}}class n{constructor(t,e={}){this.schema=t,this.options={abortEarly:!0,stripUnknown:!1,...e},this.hasAsync=Object.values(t).some(t=>t._hasAsync)}async _validateObject(t){const s={},r=[],i=new Set([...Object.keys(t),...Object.keys(this.schema)]);for(const a of i){const i=this.schema[a],n=t[a];if(!i){this.options.stripUnknown||(s[a]=n);continue}const{value:u,error:l}=await i._validate(n,t);if(l&&(r.push({field:a,message:l,type:"field"}),this.options.abortEarly))throw new e(r);i._flags.strip||(s[a]=u)}if(r.length>0)throw new e(r);return{value:s,error:null}}async validateAsync(t){try{return await this._validateObject(t)}catch(e){return{value:t,error:e}}}validate(t){if(this.hasAsync)throw new Error("Schema has async rules, use validateAsync()");let e,s;return this.validateAsync(t).then(t=>e=t).catch(e=>s={value:t,error:e}),s||e}}const u={string:()=>new a("string"),number:()=>new a("number"),boolean:()=>new a("boolean"),array:()=>new a("array"),object:(t,e)=>new n(t,e),date:()=>new a("date"),any:()=>new a("any")};return t({schema:u,ref:t=>({isRef:!0,key:t}),ValidationError:e})});
